{% extends "base.html" %}
{% load static %}
{% block style %}
<style>
  * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
  }

  @font-face {
    font-family: 'establishRetrosansOTF';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2112@1.0/establishRetrosansOTF.woff') format('woff');
    font-weight: normal;
    font-style: normal;
  }

  @font-face {
    font-family: 'establishRetrosansOTF';
    src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2112@1.0/establishRetrosansOTF.woff") format('woff');
    font-weight: normal;
    font-style: normal;
  }

  @font-face {
    font-family: 'HANAMDAUM';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2304-2@1.0/HANAMDAUM.woff2') format('woff2');
    font-weight: 400;
    font-style: normal;
  }

  @font-face {
    font-family: 'S-CoreDream-3Light';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-3Light.woff') format('woff');
    font-weight: normal;
    font-style: normal;
  }

  @font-face {
    font-family: 'TheJamsil5Bold';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302_01@1.0/TheJamsil5Bold.woff2') format('woff2');
    font-weight: 50;
    font-style: normal;
  }

  section {
    height : 120vh
  }

  p > a {
    text-decoration: none;
    color: inherit;
  }

  .button-container {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    width: 100%;
    margin: 0 auto;
  }

  .button {
    flex-shrink: 0;
    margin-left: 10px;
  }

  footer {
    padding: 2rem;
    background-color: rgb(65, 55, 48);
    font-size: 15px;
  }

  .container-fluid {
    display: flex;
    justify-content: space-evenly;
    flex-wrap: wrap;
    max-width: 100%;
    max-height: 100%;
  }
  
  @media screen and (max-width: 600px) {
    .container-fluid {
      flex-direction: column;
    }
  }
  
  @media screen and (min-width: 601px) {
    .container-fluid {
      flex-direction: row;
    }
  }

  .overflow {
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
    max-width: 25ch;
  }

  .blur {
    position: relative;
  }
  
  .blurry-image {
    filter: blur(5px);
  }
  
  .overlay-top {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 10%;
    margin-top: 5%;
    backdrop-filter: blur(10px);
  }

  .animated-text {
    animation: fadeIn 1s ease-in-out;
    animation-fill-mode: forwards;
    opacity: 0;
  }
  
  @keyframes fadeIn {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
  
  .carousel-item {
    object-fit: cover;
  }

{% endblock style %}

{% block title %}onClickTravel{% endblock title %}

{% block content %}
  <div class="mt-5 mb-5 d-flex justify-content-center align-items-center" style="max-width:100%; min-width: 100%">
    <img class="d-flex justify-content-center" style="max-width: 100%; min-width:100%;" src="{% static '/img/index_page_bg.jpg' %}" alt="profil_background_image">
  </div>
  <div class="row ms-4 mt-5 mb-5 d-flex justify-content-center align-items-center" style="width:100%;">
    <div class="col-8" style="max-width: 100%;"></div>
    <div class="col-1 d-flex justify-content-center align-items-center" style="max-width: 100%;">
      <div class="ms-5 mt-3 button btn btn-success">
        <a style="color:white; text-decoration-line: none; font-family: 'TheJamsil5Bold';" href="{% url 'posts:create' %}">글 작성하기</a>
      </div>

    </div>
  </div>
  {% comment %} 05.07.22:49 지환 수정 {% endcomment %}

  <div class="collapse d-flex flex-column justify-content-center" style="font-family: 'S-CoreDream-3Light'; margin-left:auto; margin-right:auto" id="collapseExample">
    <div class='mb-5' style=" margin-left:auto; margin-right:auto">
      <p style="color:black;"  font-size: 2rem;">
        <div class="col">
          <a class="button btn btn-outline-success" href="{% url 'posts:index' %}">전체</a>&nbsp;&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '강릉'%}">강릉</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '강원'%}">강원</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '광주'%}">광주</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '경기'%}">경기</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '경남'%}">경남</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '경북'%}">경북</a>&nbsp;&nbsp;&nbsp;
        </div>
      </p>
      <br>
      <p style="color:black; font-family: 'TheJamsil5Bold';  font-size: 2rem;">
        <div class="col">
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '경주'%}">경주</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '대구'%}">대구</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '대전'%}">대전</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '부산'%}">부산</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '서울'%}">서울</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '속초'%}">속초</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '여수'%}">여수</a>&nbsp;&nbsp;&nbsp;
        </div>
      </p>
      <br>
      <p style="color:black; font-family: 'TheJamsil5Bold';  font-size: 2rem;">
        <div class="col">
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '인천'%}">인천</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '전남'%}">전남</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '전북'%}">전북</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '전주'%}">전주</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '제주'%}">제주</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '충남'%}">충남</a>&nbsp;&nbsp;&nbsp;
          <a class="button btn btn-outline-success" href="{% url 'posts:filter' '충북'%}">충북</a>&nbsp;&nbsp;&nbsp;
        </div>
      </p>
    </div>
  </div>

  {% comment %} 05.07.22:49 지환 수정 {% endcomment %}



  <div class="container-fluid d-flex justify-content-center">
    <div class="row d-flex justify-content-center align-items-center" style="width:90%;">
      {% for post in posts %}
      <div class='col-6 col-sm-6 col-md-4 col-lg-4 col-xxl-2 d-flex justify-content-center'>
        <div class="card m-2" style="width:15rem; height:23rem">
          <a class="d-flex justify-content-center" href="{% url 'posts:detail' post.pk %}">
            {% if post.post_images.first.image.url %}
              <img style="width: 14rem; height: 11rem; max-width: 100%;max-height: 100%;"class='mt-3 mb-3 d-flex justify-content-center' src=" {{ post.post_images.first.image.url }} " alt="movie_img">
            {% else %}
              <img style="width: 14rem; height: 11rem; max-width: 100%;max-height: 100%;" class='mt-3 mb-3 d-flex justify-content-center' src="{% static 'no_image.jpg' %}" alt="no_img">
            {% endif %}
          </a>
          <div class="card-body" style="font-family: 'TheJamsil5Bold';">
            <h5 class="card-title text overflow">
              <a style="color:#198754; text-decoration-line: none;" href="{% url 'posts:detail' post.pk %}">{{ post.name }} ({{ post.city }})</a>
            </h5>
            <p class="card-text m-0 text overflow" style="font-size:medium">{{ post.address }}</p>
            <p class="card-text m-0 text" style="font-size:small">{{ post.user.username }}님의 후기</p>
            <p class="card-text m-0 text" style="font-size:small">{{ post.user.title }}</p>
            <div class="mb-2">
              <form id= "likeform" data-post-id="{{ post.pk }}">
                {% csrf_token %}
                {% if request.user in post.like_users.all %}
                    <div class="mt-2 d-flex justify-content-between">
                      <input class="d-flex justify-content-center btn btn-outline-success" type="submit" value="Cancel" id="like-{{post.pk}}">
                      <div class="text-center align-self-center">
                        💚
                        {{ post.like_users.count }}
                      </div>
                    </div>
                  {% else %}
                    <div class="mt-2 d-flex justify-content-between">
                      <input class="d-flex justify-content-center btn btn-success" type="submit" value="Like" id="like-{{post.pk}}">
                      <div class="text-center align-self-center">
                        💚
                        {{ post.like_users.count }}
                      </div>
                    </div>
                  {% endif %}
              </form>
            </div>
          </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
    {% comment %} 페이지네이션 컴포넌트 시작 {% endcomment %}
    <ul class="pagination justify-content-center mt-5">
      {% comment %}
          이전 페이지 버튼
          이전 페이지가 존재할 경우 이전 페이지 버튼 활성화
      {% endcomment %}
      {% if post.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ posts.previous_page_number }}">이전</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <a class="page-link" tabindex="-1" aria-disabled="true" href="#">이전</a>
        </li>
      {% endif %}
      {% comment %}
          페이지 번호 리스트 생성 반복문
      {% endcomment %}
      {% for page_number in posts.paginator.page_range %}
        {% comment %}
          페이지 번호가 무한히 생성되는 것을 막는 조건문
          현재 페이지에서 +- 5 까지 생성
        {% endcomment %}
        {% if page_number >= posts.number|add:-5 and page_number <= posts.number|add:5 %}
          {% if page_number == posts.number %}
            <li class="page-item active" aria-current="page">
              <a class="page-link" href="?page={{ page_number }}">{{ page_number }}</a>
            </li>
          {% else %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_number }}">{{ page_number }}</a>
            </li>
          {% endif %}
        {% endif %}
      {% endfor %}
      {% comment %}
          다음 페이지 버튼
          다음 페이지가 존재할 경우 다음 페이지 버튼 활성화
      {% endcomment %}
      {% if posts.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ posts.next_page_number }}">다음</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <a class="page-link" tabindex="-1" aria-disabled="true" href="#">다음</a>
        </li>
      {% endif %}
    </ul>
    {% comment %} 페이지네이션 컴포넌트 끝 {% endcomment %}


  <div class="mt-3" style="height:50px;"><div class="mt-3"><div></div></div></div>
  <div class="mt-5 mb-5 d-flex justify-content-center align-items-center" style="width:100%;">
    <img class="d-flex justify-content-center" style="width:100%; height:auto;" src="{% static '/img/index_bg2.jpg' %}" alt="index_background_image">
  </div>
  <div class="mb-5" style="height:50px;"><div class="mb-5"><div></div></div></div>
  <div class="mt-5 mb-5 container-fluid d-flex justify-content-evenly" style="width:100%; height:34rem; max-width: 100%;max-height: 100%; font-family: 'TheJamsil5Bold';">

    <div class="card d-flex justify-content-center" style="width: 24rem; height:34rem; max-width: 100%;max-height: 100%;">
      <p class="mt-5 mb-3 card-text d-flex justify-content-center" style="color:#198754; font-size:130%">현재 HOT한 관광도시 분포</p>
      <div class="ms-4 mt-3 mb-5 d-flex justify-content-center align-items-center" style="width:20rem; height:20rem; max-width: 100%;max-height: 100%;">
        <canvas id="myChart"></canvas>
      </div>
    </div>
    <div class="card d-flex justify-content-center" style="width: 24rem; height:34rem; max-width: 100%;max-height: 100%;">
      <p class="mt-5 mb-3 card-text d-flex justify-content-center" style="color:#198754; font-size:130%">HOT Place 한눈에 보기</p>
      <div class="ms-4 mt-3 mb-5 d-flex justify-content-center align-items-center" style="width:20rem; height:20rem; max-width: 100%;max-height: 100%;">
        <ul class="d-flex justify-content-center list-group list-group-flush">
          {% for post_name in hot_post_names %}
          <li class="list-group-item d-flex justify-content-center" style="padding-top:15%; height:70px;">- {{ post_name }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="card d-flex justify-content-center" style="max-width:50rem; min-width:50rem; height: 34rem;">
      <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel" data-interval="5000" style="height: 100%;">
        <div class="carousel-inner d-flex justify-content-center">
          {% for post in posts %}
          <div class="carousel-item {% if forloop.first %} active {% endif %}" style="object-fit: cover; width: auto; margin: auto;">
            {% if post.post_images.exists %}
              <img src="{{ post.post_images.first.image.url }}" style="object-fit: cover; max-height:34rem; min-height:34rem; width: auto; margin-left: auto; margin-right:auto;" class="d-block w-100" alt="...">
            {% else %}
              <img src="{% static 'no_image.jpg' %}" style="object-fit: cover; max-height:34rem; min-height:34rem; width: auto; margin-left: auto; margin-right:auto;" class="d-block w-100" alt="...">
            {% endif %}
          </div>
          {% endfor %}
        </div>
        <a style="color:#198754; text-decoration-line: none;" class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
          <span style="color:#198754" class="text-success carousel-control-prev-icon"></span>
        </a>
        <a style="color:#198754; text-decoration-line: none;" class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
          <span style="color:#198754" class="text-success carousel-control-next-icon"></span>
        </a>
      </div>
    </div>    
  </div>
  {% endblock content %}
  
  {% block script %}
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="{% static 'js/index.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ratios = {{ratios|safe}};
  const colorDict = {{color_dict|safe}};
  const labels = Array.from(new Set([{% for post in posts %}'{{ post.city }}',{% endfor %}]));
  const colorList = labels.map(label => colorDict[label]);
  const canvas = document.getElementById('myChart');
  const ctx = canvas.getContext('2d');
  const chart = new Chart(ctx, {
      type: 'pie',
      data: {
          labels: labels,
          datasets: [{
              data: ratios,
              backgroundColor: colorList,
              borderWidth: 1
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false,
          legend: {
              display: true,
              position: 'bottom'
          }
      }
  });
</script>
<script>
  $(document).ready(function() {
    // 이전 버튼 클릭 시
    $('.carousel-control-prev').click(function() {
      $('#carouselExampleIndicators').carousel('prev');
    });
  
    // 다음 버튼 클릭 시
    $('.carousel-control-next').click(function() {
      $('#carouselExampleIndicators').carousel('next');
    });
  });
</script>
{% endblock script %}