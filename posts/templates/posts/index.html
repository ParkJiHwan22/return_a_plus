{% extends "base.html" %}
{% load static %}
{% block style %}
<style>
  * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
  }

  @font-face {
    font-family: 'establishRetrosansOTF';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2112@1.0/establishRetrosansOTF.woff') format('woff');
    font-weight: normal;
    font-style: normal;
  }

  @font-face {
    font-family: 'HANAMDAUM';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2304-2@1.0/HANAMDAUM.woff2') format('woff2');
    font-weight: 400;
    font-style: normal;
  }

  @font-face {
    font-family: 'TheJamsil5Bold';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302_01@1.0/TheJamsil5Bold.woff2') format('woff2');
    font-weight: 50;
    font-style: normal;
  }

  section {
    height : 120vh
  }

  p > a {
    text-decoration: none;
    color: inherit;
  }

  .button-container {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    width: 100%;
    margin: 0 auto;
  }

  .button {
    flex-shrink: 0;
    margin-left: 10px;
  }

  footer {
    padding: 2rem;
    background-color: rgb(65, 55, 48);
    font-size: 15px;
  }

  .container-fluid {
    display: flex;
    justify-content: space-evenly;
    flex-wrap: wrap;
    max-width: 100%;
    max-height: 100%;
  }
  
  @media screen and (max-width: 600px) {
    .container-fluid {
      flex-direction: column;
    }
  }
  
  @media screen and (min-width: 601px) {
    .container-fluid {
      flex-direction: row;
    }
  }

  .overflow {
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
    max-width: 25ch;
  }

  .blur {
    position: relative;
  }
  
  .blurry-image {
    filter: blur(5px);
  }
  
  .overlay-top {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 10%;
    margin-top: 5%;
    backdrop-filter: blur(10px);
  }

  .animated-text {
    animation: fadeIn 1s ease-in-out;
    animation-fill-mode: forwards;
    opacity: 0;
  }
  
  @keyframes fadeIn {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
  
{% endblock style %}

{% block title %}onClickTravel{% endblock title %}

{% block content %}
  <div class="mt-5 mb-5 d-flex justify-content-center align-items-center" style="width:90%;">
    <div class="overlay-top"></div>
    <img class="d-flex justify-content-center" src="{% static '/img/profile_bg.jpg' %}" alt="profil_background_image">
  </div>
  <div class="row ms-5 mt-5 mb-5 d-flex justify-content-center align-items-center" style="width:100%;">
    <div class="col-9"></div>
    <div class="col-3 d-flex justify-content-center align-items-center">
      <div class="ms-5 mt-3 button btn btn-success">
        <a style="color:white; text-decoration-line: none; font-family: 'TheJamsil5Bold';" href="{% url 'posts:create' %}">Create</a>
      </div>
    </div>
    <div class="position-absolute text-center text-white" style="top: 80%; left: 50%; transform: translate(-50%, -50%);">
      <h1 style="font-family: 'establishRetrosansOTF'; font-size:500%;">여행을 나답게,</h1>
      <h1 style="font-family: 'establishRetrosansOTF'; font-size:500%;">꿈꾸는 대로 펼치다.</h1>
      <p class="animated-text" style="font-family: 'TheJamsil5Bold'; font-size:150%;">onClickTravel과 함께 국내 여행지 후기를 한눈에 비교해보세요!</p>
      <p class="animated-text" style="font-family: 'TheJamsil5Bold'; font-size:110%;">가족, 연인, 아이와 함께 가기 좋은 여행지 후기부터, 힐링, 먹거리, 자연 경관, 레포츠, 축제 및 이벤트 정보까지 제공하는 맞춤형 서비스</p>
    </div>
  </div>
  <div class="container-fluid d-flex justify-content-center">
    <div class="row d-flex justify-content-center align-items-center" style="width:90%;">
      {% for post in posts %}
      <div class='col-6 col-sm-6 col-md-4 col-lg-4 col-xxl-2 d-flex justify-content-center'>
        <div class="card m-2" style="width:15rem; height:23rem">
          <a class="d-flex justify-content-center" href="{% url 'posts:detail' post.pk %}">
            {% if post.post_image %}
              <img style="width: 14rem; height: 11rem; max-width: 100%;max-height: 100%;"class='mt-3 mb-3 d-flex justify-content-center' src=" {{post.post_image.url}} " alt="movie_img">
            {% else %}
              <img style="width: 14rem; height: 11rem; max-width: 100%;max-height: 100%;" class='mt-3 mb-3 d-flex justify-content-center' src="{% static 'no_image.jpg' %}" alt="no_img">
            {% endif %}
          </a>
          <div class="card-body" style="font-family: 'TheJamsil5Bold';">
            <h5 class="card-title text overflow">
              <a style="color:#198754; text-decoration-line: none;" href="{% url 'posts:detail' post.pk %}">{{ post.name }} ({{ post.city }})</a>
            </h5>
            <p class="card-text m-0 text overflow" style="font-size:medium">{{ post.address }}</p>
            <p class="card-text m-0 text" style="font-size:small">{{ post.user.username }}님의 후기</p>
            <p class="card-text m-0 text" style="font-size:small">{{ post.user.title }}</p>
            <div class="mb-2">
              <form action="{% url 'posts:like' post_pk=post.pk %}" method="POST">
                {% csrf_token %}
                {% if request.user in post.like_users.all %}
                    <div class="mt-2 d-flex justify-content-between">
                      <input class="d-flex justify-content-center btn btn-outline-success" type="submit" value="Cancel">
                      <div class="text-center align-self-center">
                        💚
                        {{ post.like_users.count }}
                      </div>
                    </div>
                  {% else %}
                    <div class="mt-2 d-flex justify-content-between">
                      <input class="d-flex justify-content-center btn btn-success" type="submit" value="Like">
                      <div class="text-center align-self-center">
                        💚
                        {{ post.like_users.count }}
                      </div>
                    </div>
                  {% endif %}
              </form>
            </div>
          </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
  <div class="mt-3" style="height:50px;"><div class="mt-3"><div></div></div></div>
  <div class="mt-5 mb-5 d-flex justify-content-center align-items-center" style="width:100%;">
    <img class="d-flex justify-content-center" style="width:100%; height:auto;" src="{% static '/img/index_bg2.jpg' %}" alt="index_background_image">
  </div>
  <div class="mb-5" style="height:50px;"><div class="mb-5"><div></div></div></div>
  <div class="mt-5 mb-5 container-fluid d-flex justify-content-evenly" style="width:100%; max-width: 100%;max-height: 100%; font-family: 'TheJamsil5Bold';">
    {% if posts_with_images %}
    <div class="card d-flex justify-content-center" style="width: 24rem; height:34rem; max-width: 100%;max-height: 100%;">
      <p class="mt-5 mb-3 card-text d-flex justify-content-center" style="color:#198754; font-size:130%">현재 HOT한 관광도시 분포</p>
      <div class="ms-4 mt-3 mb-5 d-flex justify-content-center align-items-center" style="width:20rem; height:20rem; max-width: 100%;max-height: 100%;">
        <canvas id="myChart"></canvas>
      </div>
    </div>
    <div class="card d-flex justify-content-center" style="width: 24rem; height:34rem; max-width: 100%;max-height: 100%;">
      <p class="mt-5 mb-3 card-text d-flex justify-content-center" style="color:#198754; font-size:130%">HOT Review 한눈에 보기</p>
      <div class="ms-4 mt-3 mb-5 d-flex justify-content-center align-items-center" style="width:20rem; height:20rem; max-width: 100%;max-height: 100%;">
        <ul class="d-flex justify-content-center list-group list-group-flush">
          {% for post_name in hot_post_names %}
          <li class="list-group-item d-flex justify-content-center" style="padding-top:15%; height:70px;">- {{ post_name }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}
    <div class="card d-flex justify-content-center" style="width: 50rem; height:34rem; max-width: 100%;max-height: 100%;">
      <div id="carouselExampleIndicators" class="carousel slide d-flex justify-content-center" data-ride="carousel" data-interval="5000" style="margin-top:8%; width: 100%; height:100%;">
        {% comment %} <ol class="carousel-indicators">
          {% for post in posts_with_images %}
            <li data-target="#carouselExampleIndicators" data-slide-to="{{ forloop.counter0 }}" {% if forloop.first %} class="active"{% endif %}></li>
          {% endfor %}
        </ol> {% endcomment %}
        <div class="carousel-inner">
          {% for post in posts_with_images %}
            <div style="width:50rem; margin-bottom:7%" class="carousel-item {% if forloop.first %} active {% endif %}">
              <img style="height: 100%;" src="{{ post.post_image.url }}" class="d-block w-100 d-flex justify-content-center" alt="...">
            </div>
          {% endfor %}
        </div>
        <a style="color:#198754; text-decoration-line: none;" class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
          <span style="color:#198754" class="text-success carousel-control-prev-icon"></span>
        </a>
        <a style="color:#198754; text-decoration-line: none;" class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
          <span style="color:#198754" class="text-success carousel-control-next-icon"></span>
        </a>
      </div>
    </div>
  </div>
{% endblock content %}

{% block script %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/base.js' %}"></script>
<script>
  const ratios = {{ratios|safe}};
  const colorDict = {{color_dict|safe}};
  const labels = Array.from(new Set([{% for post in posts %}'{{ post.city }}',{% endfor %}]));
  const colorList = labels.map(label => colorDict[label]);
  const canvas = document.getElementById('myChart');
  const ctx = canvas.getContext('2d');
  const chart = new Chart(ctx, {
      type: 'pie',
      data: {
          labels: labels,
          datasets: [{
              data: ratios,
              backgroundColor: colorList,
              borderWidth: 1
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false,
          legend: {
              display: true,
              position: 'bottom'
          }
      }
  });
</script>
{% endblock script %}