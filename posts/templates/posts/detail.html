{% extends "base.html" %}
{% load static %}
{% block link %}
  {% comment %} <link rel="stylesheet" type="text/css" href="{% static 'css/base.css' %}"> {% endcomment %}
{% endblock link %}

{% block title %}
  {{ post.name }}
{% endblock title %}

{% block content %}
  <div class="container">
    <h2>{{post.name}}</h2>
    <!-- 이미지 -->
    <div class="row border rounded w-50">
      <div class="col-sm-3">
        {% if post.post_image %}
          <img src="{{ post.post_image.url }}" alt="post_image">
        {% endif %}
      </div>
    </div>
  </div>
  <hr>
  <!-- 설명 -->

  <a href="{% url 'posts:index' %}" class="btn btn-primary ms-1 me-1 mt-3">Home</a>

  {% if request.user == post.user %}
    <form action="{% url 'posts:delete' post.pk %}" method="POST">
      {% csrf_token %}
      <input type="submit" value="게시글 삭제" class="btn btn-secondary ms-1 me-1 mt-3">
    </form>
    <a href="{% url 'posts:update' post.pk %}" class="btn btn-success ms-1 me-1 mt-3">수정하기</a>
  {% endif %}

  <hr>
  <div id="map" style="width:50%; height: 600px; margin-top: 20px;"></div>
  <h2>이용 후기 {{ reviews|length }}개</h2>
  <br>
  {% for review in reviews %}
    <h4>{{ review.user }}</h4>
    <p>{{ review.created_at }}</p>
    <p>리뷰:
      {{ review.review }}</p>
    <p>접근성:
      {{ review.accessibility }}</p>
    <p>비용:
      {{ review.cost }}</p>
    <p>서비스:
      {{ review.service }}</p>
    <p>편의시설:
      {{ review.convenience_facilities }}</p>
    <p>만족도:
      {{ review.satisfaction }}</p>

    {% if review.review_image %}
      <img src="{{ review.review_image.url }}" alt="review_image">
    {% endif %}

    {% if request.user == review.user %}
      <form action="{% url 'posts:review_delete' post.pk review.pk %}" method="POST">
    {% endif %}

    <hr>
    <!-- 이미지 -->
    <!-- 설명 -->
    {% if request.user == post.user %}
      <form action="{% url 'posts:delete' post.pk %}" method="POST">
        {% csrf_token %}
        <input type="submit" value="게시글 삭제" class="btn btn-secondary ms-1 me-1 mt-3">
      </form>
      <a href="{% url 'posts:update' post.pk %}" class="btn btn-success ms-1 me-1 mt-3">수정하기</a>
    {% endif %}
  {% endfor %}


    <hr>
    <h4>review list</h4>

    {% for review in reviews %}
      <p>no.
        {{ review.pk }}</p>
      <p>by
        {{ review.user }}</p>
      <p>리뷰:
        {{ review.review }}</p>
      <p>정확도:
        {{ review.accuracy }}</p>
      <p>의사소통:
        {{ review.communication }}</p>
      <p>청결:
        {{ review.cleaniness }}</p>
      <p>위치:
        {{ review.location }}</p>
      <p>체크인:
        {{ review.check_in }}</p>
      <p>시설:
        {{ review.value }}</p>

      {% if review.review_image %}
        <img src="{{ review.review_image.url }}" alt="review_image">
      {% endif %}

      {% if request.user == review.user %}
        <form action="{% url 'posts:review_delete' post.pk review.pk %}" method="POST">
      {% endif %}
    {% endfor %}

    {% if user.is_authenticated %}
      <h2>⭐</h2>
      <button>
        리뷰남기기
      </button>
      <div class="modal">
        <div class="modal_content" title="close">
          <form action="{% url 'posts:review_create' post.pk %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            {{ review_form.as_p }}
            <input type="submit" value="댓글작성" class="btn btn-primary ms-1 me-1 mt-3 modal_form">
          </form>
        </div>

      </div>
    </div>
    {% else %}
    <a class="btn btn-primary" href="{% url 'accounts:login' %}" role="button">로그인하고 리뷰 남기기</a>
    {% endif %}

  <script>
  const place = "{{ location }}".replace(/&#x27;/g, "\"");
  const places = JSON.parse(place)
  const name = "{{ post.name }}"
  const names = JSON.parse(name)
  
  window.initMap = function () {
    const map = new google.maps.Map(document.getElementById("map"), {
      center: places,
      zoom: 15
    });
    new google.maps.Marker({
      position: places,
      map,
      title: names,
    });
  }
  </script>
{% endblock content %}