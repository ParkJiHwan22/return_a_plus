{% extends "base.html" %}
{% load static %}

{% block link %}
  {% comment %} <link rel="stylesheet" type="text/css" href="{% static 'css/detail.css' %}"> {% endcomment %}
{% endblock link %}

{% block style %}
  <style>
    .modal{
      position:absolute;
      width:100%; 
      height:100%; 
      background: rgba(0,0,0,0.8);
      top:0; 
      left:O; 
      display:none;
    }
    .button{
      flex-shrink: 0;
      margin-left: 10px;
      {% comment %} position:absolute; 
      top:50%; left:50%;
      width:120px; 
      height:30px; 
      margin-top:-15px; 
      margin-left:-60px;
      line-height:15px; 
      cursor:pointer; {% endcomment %}
    }
    
    .modal_content{
      width:600px; 
      height:600px;
      background:#fff; 
      border-radius:10px;
      position:relative; 
      top:50%; left:50%;
      transform: translate(-50%, -50%);
      text-align:center;
      box-sizing:border-box; 
      padding:74px 0;
      line-height:23px; 
      cursor:pointer;
    }
  </style>
{% endblock style %}
  
{% block title %}
  {{ post.name }}
{% endblock title %}

{% block content %}

<div class="container">  
  <hr>
  <p>작성자:<a href="{% url 'accounts:profile' post.user.username %}">{{ post.user }}</a></p> 
  {% comment %} profile로 이동하는 링크 걸어야 함 {% endcomment %}
  <br>
  <!-- 이미지 -->
  <div class="row border rounded w-50">
    <div class="col-sm-3">
      {% if post.post_image %}
      <img src="{{ post.post_image.url }}" alt="post_image">
      {% endif %}
    </div>
  </div>
  <!-- 이미지 -->

  <!-- 이름 -->
  <h1>{{post.name}} ( {{ post.address }} )</h1>
  <hr>
  <!-- 이름 -->

  <!-- 설명 -->
  <h2>관광 명소 설명</h2>
  <p>{{ post.description }}</p>
  <hr>
  <!-- 설명 -->

  <!-- 시설 -->
  <h2>관광 명소 종류</h2>
  <p> 입장료 :
    {% if post.price == 0 %}
      없음
    {% else %}
      {{ post.price }}
    {% endif %}
  </p>

  <hr>
  <!-- 시설 -->

  {% if request.user == post.user %}
    <form action="{% url 'posts:delete' post.pk %}" method="POST">
      {% csrf_token %}
      <input type="submit" value="게시글 삭제" class="btn btn-secondary ms-1 me-1 mt-3">
      <a href="{% url 'posts:update' post.pk %}" class="btn btn-success ms-1 me-1 mt-3">수정하기</a>
    </form>
  {% endif %}

  <!-- 후기 -->
  {% for review in reviews %}
    <div class="row">
      <div class="col">
        <p>접근성:
          {{ review.accessibility }}</p>
        <p>비용:
          {{ review.cost }}</p>
        <p>서비스:
          {{ review.service }}</p>
      </div>
      <div class="col">
        <p>편의시설:
          {{ review.convenience_facilities }}</p>
        <p>만족도:
          {{ review.satisfaction }}</p>
      </div>
    </div>

    <div class="row justify-content-start">
      {% if review.profile_image %}
        <img src="{{ person.profile_image.url }}" alt="post_image" class="col-4 rounded-circle profile-img w-50">
      {% else %}
        <img src="https://i.pinimg.com/564x/dc/93/f7/dc93f70b6620fc090ef6d1249f01f55a.jpg" alt="no_image" class="col-4 rounded-circle profile-img">
      {% endif %}

      <div class="col-6">
        <p>{{ review.user }}</p>
        <p>작성일:{{ review.created_at }}</p>
    </div>

      <div>
        {% if review.review_image %}
        <img src="{{ review.review_image.url }}" alt="review_image">
        {% endif %}
      </div>
      <p>{{ review.review }}</p>
    </div>

    {% if review.review_image %}
      <img src="{{ review.review_image.url }}" alt="review_image">
    {% endif %}

    {% if request.user == review.user %}
      <form action="{% url 'posts:review_delete' post.pk review.pk %}" method="POST">
    {% endif %}
  {% endfor %}
  <!-- 후기 -->


  {% if user.is_authenticated %}
    <button class="btn btn-primary ms-1 me-1 mt-3">
      리뷰남기기
    </button>
    <div class="modal">
      <div class="modal_content" title="close">
        <form action="{% url 'posts:review_create' post.pk %}" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          {{ review_form.as_p }}
          <input type="submit" value="댓글작성" class="btn btn-primary ms-1 me-1 mt-3 modal_form">
        </form>
      </div>
    </div>
    
    {% else %}
    <a class="btn btn-primary" href="{% url 'accounts:login' %}" role="button">로그인하고 리뷰 남기기</a>
    {% endif %}
    
    
    <!-- 위치 -->
    <h4> 숙소 위치 </h4>
    <div id="map" style="height: 600px;"></div>
  </div>

  <script>
  const place = "{{ location }}".replace(/&#x27;/g, "\"");
  const places = JSON.parse(place)
  const name = "{{ post.name }}"
  window.initMap = function () {
    const map = new google.maps.Map(document.getElementById("map"), {
      center: places,
      zoom: 15
    });
    new google.maps.Marker({
      position: places,
      map,
      title: name,
    });
  }
  </script>
{% comment %}
<script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAd9M3rcxiyzS9IxbErxaMv45mw94kQFxY&callback=initMap">
</script>
{% endcomment %}
{% endblock content %}

